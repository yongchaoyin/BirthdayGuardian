import{_ as Y,r as f,a as P,g as S,h as Z,c as $,o as ee,b as l,w as a,d as u,E as n,u as le,e as s,f as w,t as v,n as ae}from"./index-BLLjHX9z.js";import{g as se,u as oe,a as re,c as ne,b as te}from"./user-Do2woNxy.js";import"./request-Eu6Wjmw7.js";const de={class:"profile-container"},ue={class:"header-actions"},ie={class:"user-info"},me={class:"info-item"},pe={class:"info-item"},fe={class:"info-item"},ge={class:"info-item"},we={class:"info-item"},ve={class:"info-item"},ce={__name:"Profile",setup(_e){const U=le(),d=f({}),I=f(null),F=f(null),E=f(null),q=f(null),V=f(!1),h=f(!1),k=f(!1),x=f(!1),i=P({oldPassword:"",newPassword:"",confirmPassword:""}),p=P({email:"",password:""}),c=P({username:""}),_=P({phone:""}),N={oldPassword:[{required:!0,message:"请输入旧密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在6-20之间",trigger:"blur"}],confirmPassword:[{required:!0,validator:(o,e,m)=>{e===""?m(new Error("请再次输入密码")):e!==i.newPassword?m(new Error("两次输入的密码不一致")):m()},trigger:"blur"}]},z={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},B={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在3-20之间",trigger:"blur"}]},T={phone:[{required:!0,message:"请输入手机号",trigger:"blur"}]},y=async()=>{try{const o=await se();d.value=o.data,localStorage.setItem("userInfo",JSON.stringify(o.data)),c.username=o.data.username||"",_.phone=o.data.phone||""}catch{n.error("获取用户信息失败")}},A=S(()=>d.value.vipActive?"VIP守护礼遇":"温馨体验计划"),D=S(()=>d.value.vipExpireTime?new Date(d.value.vipExpireTime).toLocaleString("zh-CN"):"—"),M=async()=>{try{await E.value.validate(),k.value=!0,await oe({username:c.username}),n.success("用户名更新成功"),await y()}catch(o){o?.response?n.error(o.response.data.message||"更新用户名失败"):o?.message&&n.error(o.message)}finally{k.value=!1}},J=async()=>{try{await q.value.validate(),x.value=!0,await re({phone:_.phone}),n.success("手机号更新成功"),await y()}catch(o){o?.response?n.error(o.response.data.message||"更新手机号失败"):o?.message&&n.error(o.message)}finally{x.value=!1}},O=async()=>{try{await I.value.validate(),V.value=!0,await ne({oldPassword:i.oldPassword,newPassword:i.newPassword}),n.success("密码修改成功，请重新登录"),setTimeout(()=>{L()},1500)}catch(o){o.response?n.error(o.response.data.message||"修改密码失败"):o.message&&n.error(o.message)}finally{V.value=!1}},j=async()=>{try{await F.value.validate(),h.value=!0,await te({email:p.email,password:p.password}),n.success("邮箱修改成功"),p.email="",p.password="",await y()}catch(o){o.response?n.error(o.response.data.message||"修改邮箱失败"):o.message&&n.error(o.message)}finally{h.value=!1}},G=()=>{U.push("/home")},L=()=>{localStorage.removeItem("token"),localStorage.removeItem("userInfo"),U.push("/login")};return Z(()=>{y()}),(o,e)=>{const m=u("el-button"),H=u("el-header"),K=u("el-divider"),g=u("el-input"),t=u("el-form-item"),b=u("el-form"),C=u("el-card"),R=u("el-col"),Q=u("el-row"),W=u("el-main"),X=u("el-container");return ee(),$("div",de,[l(X,null,{default:a(()=>[l(H,{class:"header"},{default:a(()=>[e[9]||(e[9]=s("h2",null,"个人中心",-1)),s("div",ue,[l(m,{onClick:G,size:"small"},{default:a(()=>[...e[7]||(e[7]=[w("返回首页",-1)])]),_:1}),l(m,{onClick:L,size:"small",type:"danger"},{default:a(()=>[...e[8]||(e[8]=[w("退出",-1)])]),_:1})])]),_:1}),l(W,null,{default:a(()=>[l(Q,{gutter:20},{default:a(()=>[l(R,{span:24,md:8},{default:a(()=>[l(C,{class:"user-info-card"},{header:a(()=>[...e[10]||(e[10]=[s("div",{class:"card-header"},[s("span",null,"用户信息")],-1)])]),default:a(()=>[s("div",ie,[s("div",me,[e[11]||(e[11]=s("label",null,"用户名：",-1)),s("span",null,v(d.value.username),1)]),s("div",pe,[e[12]||(e[12]=s("label",null,"邮箱：",-1)),s("span",null,v(d.value.email),1)]),s("div",fe,[e[13]||(e[13]=s("label",null,"手机号：",-1)),s("span",null,v(d.value.phone||"未填写"),1)]),s("div",ge,[e[14]||(e[14]=s("label",null,"会员等级：",-1)),s("span",{class:ae(["membership-tag",d.value.vipActive?"vip":"free"])},v(A.value),3)]),s("div",we,[e[15]||(e[15]=s("label",null,"守护名额：",-1)),s("span",null,v(d.value.maxRoleCount||(d.value.vipActive?20:3))+" 位亲友",1)]),s("div",ve,[e[16]||(e[16]=s("label",null,"VIP到期：",-1)),s("span",null,v(D.value),1)]),e[19]||(e[19]=s("p",{class:"membership-tip"}," 温馨提示：VIP有效期一年，若到期我们会自动切换至温馨体验计划，您可随时联系管理员续订。 ",-1)),e[20]||(e[20]=s("p",{class:"membership-tip contact"},[w(" 开通或续订 VIP？请邮件联系站主："),s("a",{href:"mailto:yinyc0925@outlook.com",target:"_blank"},"yinyc0925@outlook.com")],-1)),l(K),l(b,{ref_key:"usernameFormRef",ref:E,model:c,rules:B,"label-width":"80px",class:"inline-form"},{default:a(()=>[l(t,{label:"用户名",prop:"username"},{default:a(()=>[l(g,{modelValue:c.username,"onUpdate:modelValue":e[0]||(e[0]=r=>c.username=r)},null,8,["modelValue"])]),_:1}),l(t,null,{default:a(()=>[l(m,{type:"primary",onClick:M,loading:k.value},{default:a(()=>[...e[17]||(e[17]=[w("保存用户名",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),l(b,{ref_key:"phoneFormRef",ref:q,model:_,rules:T,"label-width":"80px",class:"inline-form"},{default:a(()=>[l(t,{label:"手机号",prop:"phone"},{default:a(()=>[l(g,{modelValue:_.phone,"onUpdate:modelValue":e[1]||(e[1]=r=>_.phone=r),placeholder:"用于接收通知及短信"},null,8,["modelValue"])]),_:1}),l(t,null,{default:a(()=>[l(m,{type:"primary",onClick:J,loading:x.value},{default:a(()=>[...e[18]||(e[18]=[w("保存手机号",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1}),l(R,{span:24,md:8},{default:a(()=>[l(C,null,{header:a(()=>[...e[21]||(e[21]=[s("div",{class:"card-header"},[s("span",null,"修改密码")],-1)])]),default:a(()=>[l(b,{model:i,rules:N,ref_key:"passwordFormRef",ref:I,"label-width":"100px"},{default:a(()=>[l(t,{label:"旧密码",prop:"oldPassword"},{default:a(()=>[l(g,{modelValue:i.oldPassword,"onUpdate:modelValue":e[2]||(e[2]=r=>i.oldPassword=r),type:"password",placeholder:"请输入旧密码"},null,8,["modelValue"])]),_:1}),l(t,{label:"新密码",prop:"newPassword"},{default:a(()=>[l(g,{modelValue:i.newPassword,"onUpdate:modelValue":e[3]||(e[3]=r=>i.newPassword=r),type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),l(t,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[l(g,{modelValue:i.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=r=>i.confirmPassword=r),type:"password",placeholder:"请再次输入新密码"},null,8,["modelValue"])]),_:1}),l(t,null,{default:a(()=>[l(m,{type:"primary",onClick:O,loading:V.value},{default:a(()=>[...e[22]||(e[22]=[w("修改密码",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),l(R,{span:24,md:8},{default:a(()=>[l(C,null,{header:a(()=>[...e[23]||(e[23]=[s("div",{class:"card-header"},[s("span",null,"修改邮箱")],-1)])]),default:a(()=>[l(b,{model:p,rules:z,ref_key:"emailFormRef",ref:F,"label-width":"100px"},{default:a(()=>[l(t,{label:"当前邮箱"},{default:a(()=>[l(g,{value:d.value.email,disabled:""},null,8,["value"])]),_:1}),l(t,{label:"新邮箱",prop:"email"},{default:a(()=>[l(g,{modelValue:p.email,"onUpdate:modelValue":e[5]||(e[5]=r=>p.email=r),placeholder:"请输入新邮箱"},null,8,["modelValue"])]),_:1}),l(t,{label:"确认密码",prop:"password"},{default:a(()=>[l(g,{modelValue:p.password,"onUpdate:modelValue":e[6]||(e[6]=r=>p.password=r),type:"password",placeholder:"请输入密码确认"},null,8,["modelValue"])]),_:1}),l(t,null,{default:a(()=>[l(m,{type:"primary",onClick:j,loading:h.value},{default:a(()=>[...e[24]||(e[24]=[w("修改邮箱",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}},he=Y(ce,[["__scopeId","data-v-a38b8d6f"]]);export{he as default};
