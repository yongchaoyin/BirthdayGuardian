import{_ as re,r as g,a as L,g as A,h as se,c as T,o as C,b as l,w as t,d as u,E as c,u as ue,e as r,t as d,f as i,i as ie,F as de,j as me,k as pe,n as ce,l as fe}from"./index-BLLjHX9z.js";import{r as w}from"./request-Eu6Wjmw7.js";import{g as ve}from"./announcement-CbEMjMdz.js";import{g as _e}from"./user-Do2woNxy.js";function be(){return w({url:"/roles",method:"get"})}function ge(_){return w({url:"/roles",method:"post",data:_})}function ye(_,y){return w({url:`/roles/${_}`,method:"put",data:y})}function he(_){return w({url:`/roles/${_}`,method:"delete"})}const Ve={class:"home-container"},Ce={class:"user-info"},we={key:0,class:"announcements-section"},ke={class:"announcement-header"},xe={class:"announcement-title"},De={class:"announcement-time"},Re={class:"announcement-content"},Ie={class:"banner-text"},Ae={class:"banner-meta"},Te={class:"slot-info"},Pe={class:"toolbar"},Ne={class:"toolbar-hint"},Le={class:"membership-rules"},Ue={__name:"Home",setup(_){const y=ue(),k=g([]),x=g([]),b=g(!1),h=g(!1),V=g(null),D=g(JSON.parse(localStorage.getItem("userInfo")||"{}")),a=L({membershipLevel:"FREE",vipActive:!1,maxRoleCount:3,currentCount:0}),s=L({id:null,roleType:"",roleName:"",birthDate:"",calendarType:1,remindDays:3,rolePhone:"",remark:""}),U={roleType:[{required:!0,message:"请选择角色类型",trigger:"change"}],roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],birthDate:[{required:!0,message:"请选择出生日期",trigger:"change"}],remindDays:[{required:!0,message:"请输入提前提醒天数",trigger:"blur"}]},R=async()=>{try{const e=(await be()).data||{};k.value=e.roles||[],a.membershipLevel=e.membershipLevel||a.membershipLevel,a.vipActive=!!e.vipActive,a.maxRoleCount=e.maxRoleCount??(a.vipActive?20:3),a.currentCount=e.currentCount??k.value.length}catch{c.error("加载角色列表失败")}},S=async()=>{try{const o=await _e();o.data&&(D.value=o.data,localStorage.setItem("userInfo",JSON.stringify(o.data)),a.membershipLevel=o.data.membershipLevel||a.membershipLevel,a.vipActive=!!o.data.vipActive,a.maxRoleCount=o.data.maxRoleCount||(a.vipActive?20:3))}catch(o){console.error("获取用户信息失败:",o)}},B=async()=>{try{const o=await ve();o.code===200&&(x.value=o.data)}catch(o){console.error("加载公告失败:",o)}},E=o=>o?new Date(o).toLocaleString("zh-CN"):"",M=()=>{if(a.currentCount>=a.maxRoleCount){a.vipActive?c.info("您已温暖守护满额亲友，如需更多名额请与我们联系~"):c.warning("温馨体验会员最多可守护 "+a.maxRoleCount+" 位亲友，升级VIP即可拥抱更多挚爱哦~");return}h.value=!1,q(),b.value=!0},Y=o=>{h.value=!0,Object.assign(s,o),b.value=!0},F=async o=>{try{await fe.confirm("确定要删除这个角色吗？","提示",{type:"warning"}),await he(o.id),c.success("删除成功"),R()}catch(e){e!=="cancel"&&c.error("删除失败")}},z=async()=>{try{await V.value.validate(),h.value?(await ye(s.id,s),c.success("更新成功")):(await ge(s),c.success("添加成功")),b.value=!1,R()}catch(o){o.response?c.error(o.response.data.message||"操作失败"):o.message&&c.error(o.message)}},q=()=>{Object.assign(s,{id:null,roleType:"",roleName:"",birthDate:"",calendarType:1,remindDays:3,rolePhone:"",remark:""}),V.value&&V.value.clearValidate()},$=()=>{localStorage.removeItem("token"),localStorage.removeItem("userInfo"),y.push("/login")},O=()=>{y.push("/profile")},j=A(()=>Math.max(0,a.maxRoleCount-a.currentCount)),H=A(()=>a.vipActive?"VIP守护礼遇":"温馨体验计划"),J=A(()=>a.vipActive?"VIP会员可同时守护 20 位亲友，我们会在每一个重要时刻为你点亮提醒。":"当前可守护 "+a.maxRoleCount+" 位亲友，升级VIP可拥有更多贴心提醒与未来短信服务。");return se(()=>{S(),R(),B()}),(o,e)=>{const f=u("el-button"),G=u("el-header"),P=u("el-card"),K=u("el-tag"),p=u("el-table-column"),Q=u("el-table"),W=u("el-main"),X=u("el-container"),m=u("el-option"),Z=u("el-select"),v=u("el-form-item"),I=u("el-input"),N=u("el-radio"),ee=u("el-radio-group"),le=u("el-date-picker"),te=u("el-input-number"),oe=u("el-form"),ae=u("el-dialog");return C(),T("div",Ve,[l(X,null,{default:t(()=>[l(G,{class:"header"},{default:t(()=>[e[11]||(e[11]=r("h2",null,"生日守护者",-1)),r("div",Ce,[r("span",null,d(D.value.username),1),l(f,{onClick:O,size:"small",type:"primary"},{default:t(()=>[...e[9]||(e[9]=[i("个人中心",-1)])]),_:1}),l(f,{onClick:$,size:"small",type:"danger"},{default:t(()=>[...e[10]||(e[10]=[i("退出",-1)])]),_:1})])]),_:1}),l(W,null,{default:t(()=>[x.value.length>0?(C(),T("div",we,[(C(!0),T(de,null,me(x.value,n=>(C(),pe(P,{key:n.id,class:"announcement-card"},{header:t(()=>[r("div",ke,[r("span",xe,"📢 "+d(n.title),1),r("span",De,d(E(n.createTime)),1)])]),default:t(()=>[r("div",Re,d(n.content),1)]),_:2},1024))),128))])):ie("",!0),r("div",{class:ce(["welcome-banner",{vip:a.vipActive}])},[r("div",Ie,[r("h3",null,"Hi "+d(D.value.username||"守护者")+"，一起守护挚爱的日子",1),r("p",null,d(J.value),1)]),r("div",Ae,[l(K,{type:a.vipActive?"success":"warning",effect:"light"},{default:t(()=>[i(d(H.value),1)]),_:1},8,["type"]),r("span",Te,"还能添加 "+d(j.value)+" 位亲友",1)])],2),r("div",Pe,[l(f,{type:"primary",onClick:M,disabled:a.currentCount>=a.maxRoleCount},{default:t(()=>[...e[12]||(e[12]=[i(" 添加守护对象 ",-1)])]),_:1},8,["disabled"]),r("span",Ne,d(a.currentCount)+" / "+d(a.maxRoleCount)+" 位亲友已加入守护 ",1)]),r("div",Le,[l(P,{class:"rule-card"},{header:t(()=>[...e[13]||(e[13]=[r("span",null,"🎈 守护规则速览",-1)])]),default:t(()=>[e[14]||(e[14]=r("ul",null,[r("li",null,[r("strong",null,"温馨体验"),i("：可守护 3 位亲友，享受基础邮件提醒。")]),r("li",null,[r("strong",null,"VIP 守护礼遇"),i("：可守护 20 位亲友，生日当天自动发送短信暖语。")]),r("li",null,"填写角色电话后，VIP 用户将在生日当天把备注祝福通过短信送给对方。"),r("li",null,[i("如需开通 / 续订 VIP，请发送邮件至 "),r("a",{href:"mailto:yinyc0925@outlook.com",target:"_blank"},"yinyc0925@outlook.com"),i(" 联系站主。")])],-1))]),_:1})]),l(Q,{data:k.value,style:{width:"100%"},border:""},{default:t(()=>[l(p,{prop:"roleType",label:"角色类型",width:"120"}),l(p,{prop:"roleName",label:"角色名称",width:"120"}),l(p,{prop:"birthDate",label:"出生日期",width:"120"}),l(p,{label:"日历类型",width:"100"},{default:t(n=>[i(d(n.row.calendarType===1?"阳历":"阴历"),1)]),_:1}),l(p,{prop:"lunarBirthDate",label:"阴历生日",width:"120"}),l(p,{prop:"remindDays",label:"提前提醒天数",width:"120"}),l(p,{prop:"rolePhone",label:"角色电话",width:"140"}),l(p,{prop:"remark",label:"备注"}),l(p,{label:"操作",width:"150",fixed:"right"},{default:t(n=>[l(f,{size:"small",onClick:ne=>Y(n.row)},{default:t(()=>[...e[15]||(e[15]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(f,{size:"small",type:"danger",onClick:ne=>F(n.row)},{default:t(()=>[...e[16]||(e[16]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),l(ae,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=n=>b.value=n),title:h.value?"编辑角色":"添加角色",width:"500px"},{footer:t(()=>[l(f,{onClick:e[7]||(e[7]=n=>b.value=!1)},{default:t(()=>[...e[19]||(e[19]=[i("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:z},{default:t(()=>[...e[20]||(e[20]=[i("确定",-1)])]),_:1})]),default:t(()=>[l(oe,{model:s,rules:U,ref_key:"roleFormRef",ref:V,"label-width":"120px"},{default:t(()=>[l(v,{label:"角色类型",prop:"roleType"},{default:t(()=>[l(Z,{modelValue:s.roleType,"onUpdate:modelValue":e[0]||(e[0]=n=>s.roleType=n),placeholder:"请选择角色类型"},{default:t(()=>[l(m,{label:"父亲",value:"父亲"}),l(m,{label:"母亲",value:"母亲"}),l(m,{label:"爷爷",value:"爷爷"}),l(m,{label:"奶奶",value:"奶奶"}),l(m,{label:"外公",value:"外公"}),l(m,{label:"外婆",value:"外婆"}),l(m,{label:"兄弟",value:"兄弟"}),l(m,{label:"姐妹",value:"姐妹"}),l(m,{label:"朋友",value:"朋友"}),l(m,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"角色名称",prop:"roleName"},{default:t(()=>[l(I,{modelValue:s.roleName,"onUpdate:modelValue":e[1]||(e[1]=n=>s.roleName=n),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),l(v,{label:"日历类型",prop:"calendarType"},{default:t(()=>[l(ee,{modelValue:s.calendarType,"onUpdate:modelValue":e[2]||(e[2]=n=>s.calendarType=n)},{default:t(()=>[l(N,{label:1},{default:t(()=>[...e[17]||(e[17]=[i("阳历",-1)])]),_:1}),l(N,{label:2},{default:t(()=>[...e[18]||(e[18]=[i("阴历",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"出生日期",prop:"birthDate"},{default:t(()=>[l(le,{modelValue:s.birthDate,"onUpdate:modelValue":e[3]||(e[3]=n=>s.birthDate=n),type:"date",placeholder:"请选择出生日期",format:"YYYY年M月D号 dddd","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(v,{label:"提前提醒天数",prop:"remindDays"},{default:t(()=>[l(te,{modelValue:s.remindDays,"onUpdate:modelValue":e[4]||(e[4]=n=>s.remindDays=n),min:1,max:30},null,8,["modelValue"])]),_:1}),l(v,{label:"角色电话",prop:"rolePhone"},{default:t(()=>[l(I,{modelValue:s.rolePhone,"onUpdate:modelValue":e[5]||(e[5]=n=>s.rolePhone=n),placeholder:"用于生日当天发送短信"},null,8,["modelValue"])]),_:1}),l(v,{label:"备注",prop:"remark"},{default:t(()=>[l(I,{modelValue:s.remark,"onUpdate:modelValue":e[6]||(e[6]=n=>s.remark=n),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ye=re(Ue,[["__scopeId","data-v-2e08ec63"]]);export{Ye as default};
