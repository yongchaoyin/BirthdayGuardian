import{_ as re,r as g,a as L,g as A,h as se,c as T,o as C,b as l,w as t,d as u,E as c,u as ue,e as r,t as d,f as i,i as ie,F as de,j as me,k as pe,n as ce,l as fe}from"./index-BLLjHX9z.js";import{r as w}from"./request-Eu6Wjmw7.js";import{g as ve}from"./announcement-CbEMjMdz.js";import{g as _e}from"./user-Do2woNxy.js";function be(){return w({url:"/roles",method:"get"})}function ge(_){return w({url:"/roles",method:"post",data:_})}function ye(_,y){return w({url:`/roles/${_}`,method:"put",data:y})}function he(_){return w({url:`/roles/${_}`,method:"delete"})}const Ve={class:"home-container"},Ce={class:"user-info"},we={key:0,class:"announcements-section"},ke={class:"announcement-header"},xe={class:"announcement-title"},De={class:"announcement-time"},Re={class:"announcement-content"},Ie={class:"banner-text"},Ae={class:"banner-meta"},Te={class:"slot-info"},Pe={class:"toolbar"},Ne={class:"toolbar-hint"},Le={class:"membership-rules"},Ue={__name:"Home",setup(_){const y=ue(),k=g([]),x=g([]),b=g(!1),h=g(!1),V=g(null),D=g(JSON.parse(localStorage.getItem("userInfo")||"{}")),a=L({membershipLevel:"FREE",vipActive:!1,maxRoleCount:3,currentCount:0}),s=L({id:null,roleType:"",roleName:"",birthDate:"",calendarType:1,remindDays:3,rolePhone:"",remark:""}),U={roleType:[{required:!0,message:"è¯·é€‰æ‹©è§’è‰²ç±»åž‹",trigger:"change"}],roleName:[{required:!0,message:"è¯·è¾“å…¥è§’è‰²åç§°",trigger:"blur"}],birthDate:[{required:!0,message:"è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ",trigger:"change"}],remindDays:[{required:!0,message:"è¯·è¾“å…¥æå‰æé†’å¤©æ•°",trigger:"blur"}]},R=async()=>{try{const e=(await be()).data||{};k.value=e.roles||[],a.membershipLevel=e.membershipLevel||a.membershipLevel,a.vipActive=!!e.vipActive,a.maxRoleCount=e.maxRoleCount??(a.vipActive?20:3),a.currentCount=e.currentCount??k.value.length}catch{c.error("åŠ è½½è§’è‰²åˆ—è¡¨å¤±è´¥")}},S=async()=>{try{const o=await _e();o.data&&(D.value=o.data,localStorage.setItem("userInfo",JSON.stringify(o.data)),a.membershipLevel=o.data.membershipLevel||a.membershipLevel,a.vipActive=!!o.data.vipActive,a.maxRoleCount=o.data.maxRoleCount||(a.vipActive?20:3))}catch(o){console.error("èŽ·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",o)}},B=async()=>{try{const o=await ve();o.code===200&&(x.value=o.data)}catch(o){console.error("åŠ è½½å…¬å‘Šå¤±è´¥:",o)}},E=o=>o?new Date(o).toLocaleString("zh-CN"):"",M=()=>{if(a.currentCount>=a.maxRoleCount){a.vipActive?c.info("æ‚¨å·²æ¸©æš–å®ˆæŠ¤æ»¡é¢äº²å‹ï¼Œå¦‚éœ€æ›´å¤šåé¢è¯·ä¸Žæˆ‘ä»¬è”ç³»~"):c.warning("æ¸©é¦¨ä½“éªŒä¼šå‘˜æœ€å¤šå¯å®ˆæŠ¤ "+a.maxRoleCount+" ä½äº²å‹ï¼Œå‡çº§VIPå³å¯æ‹¥æŠ±æ›´å¤šæŒšçˆ±å“¦~");return}h.value=!1,q(),b.value=!0},Y=o=>{h.value=!0,Object.assign(s,o),b.value=!0},F=async o=>{try{await fe.confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè§’è‰²å—ï¼Ÿ","æç¤º",{type:"warning"}),await he(o.id),c.success("åˆ é™¤æˆåŠŸ"),R()}catch(e){e!=="cancel"&&c.error("åˆ é™¤å¤±è´¥")}},z=async()=>{try{await V.value.validate(),h.value?(await ye(s.id,s),c.success("æ›´æ–°æˆåŠŸ")):(await ge(s),c.success("æ·»åŠ æˆåŠŸ")),b.value=!1,R()}catch(o){o.response?c.error(o.response.data.message||"æ“ä½œå¤±è´¥"):o.message&&c.error(o.message)}},q=()=>{Object.assign(s,{id:null,roleType:"",roleName:"",birthDate:"",calendarType:1,remindDays:3,rolePhone:"",remark:""}),V.value&&V.value.clearValidate()},$=()=>{localStorage.removeItem("token"),localStorage.removeItem("userInfo"),y.push("/login")},O=()=>{y.push("/profile")},j=A(()=>Math.max(0,a.maxRoleCount-a.currentCount)),H=A(()=>a.vipActive?"VIPå®ˆæŠ¤ç¤¼é‡":"æ¸©é¦¨ä½“éªŒè®¡åˆ’"),J=A(()=>a.vipActive?"VIPä¼šå‘˜å¯åŒæ—¶å®ˆæŠ¤ 20 ä½äº²å‹ï¼Œæˆ‘ä»¬ä¼šåœ¨æ¯ä¸€ä¸ªé‡è¦æ—¶åˆ»ä¸ºä½ ç‚¹äº®æé†’ã€‚":"å½“å‰å¯å®ˆæŠ¤ "+a.maxRoleCount+" ä½äº²å‹ï¼Œå‡çº§VIPå¯æ‹¥æœ‰æ›´å¤šè´´å¿ƒæé†’ä¸Žæœªæ¥çŸ­ä¿¡æœåŠ¡ã€‚");return se(()=>{S(),R(),B()}),(o,e)=>{const f=u("el-button"),G=u("el-header"),P=u("el-card"),K=u("el-tag"),p=u("el-table-column"),Q=u("el-table"),W=u("el-main"),X=u("el-container"),m=u("el-option"),Z=u("el-select"),v=u("el-form-item"),I=u("el-input"),N=u("el-radio"),ee=u("el-radio-group"),le=u("el-date-picker"),te=u("el-input-number"),oe=u("el-form"),ae=u("el-dialog");return C(),T("div",Ve,[l(X,null,{default:t(()=>[l(G,{class:"header"},{default:t(()=>[e[11]||(e[11]=r("h2",null,"ç”Ÿæ—¥å®ˆæŠ¤è€…",-1)),r("div",Ce,[r("span",null,d(D.value.username),1),l(f,{onClick:O,size:"small",type:"primary"},{default:t(()=>[...e[9]||(e[9]=[i("ä¸ªäººä¸­å¿ƒ",-1)])]),_:1}),l(f,{onClick:$,size:"small",type:"danger"},{default:t(()=>[...e[10]||(e[10]=[i("é€€å‡º",-1)])]),_:1})])]),_:1}),l(W,null,{default:t(()=>[x.value.length>0?(C(),T("div",we,[(C(!0),T(de,null,me(x.value,n=>(C(),pe(P,{key:n.id,class:"announcement-card"},{header:t(()=>[r("div",ke,[r("span",xe,"ðŸ“¢ "+d(n.title),1),r("span",De,d(E(n.createTime)),1)])]),default:t(()=>[r("div",Re,d(n.content),1)]),_:2},1024))),128))])):ie("",!0),r("div",{class:ce(["welcome-banner",{vip:a.vipActive}])},[r("div",Ie,[r("h3",null,"Hi "+d(D.value.username||"å®ˆæŠ¤è€…")+"ï¼Œä¸€èµ·å®ˆæŠ¤æŒšçˆ±çš„æ—¥å­",1),r("p",null,d(J.value),1)]),r("div",Ae,[l(K,{type:a.vipActive?"success":"warning",effect:"light"},{default:t(()=>[i(d(H.value),1)]),_:1},8,["type"]),r("span",Te,"è¿˜èƒ½æ·»åŠ  "+d(j.value)+" ä½äº²å‹",1)])],2),r("div",Pe,[l(f,{type:"primary",onClick:M,disabled:a.currentCount>=a.maxRoleCount},{default:t(()=>[...e[12]||(e[12]=[i(" æ·»åŠ å®ˆæŠ¤å¯¹è±¡ ",-1)])]),_:1},8,["disabled"]),r("span",Ne,d(a.currentCount)+" / "+d(a.maxRoleCount)+" ä½äº²å‹å·²åŠ å…¥å®ˆæŠ¤ ",1)]),r("div",Le,[l(P,{class:"rule-card"},{header:t(()=>[...e[13]||(e[13]=[r("span",null,"ðŸŽˆ å®ˆæŠ¤è§„åˆ™é€Ÿè§ˆ",-1)])]),default:t(()=>[e[14]||(e[14]=r("ul",null,[r("li",null,[r("strong",null,"æ¸©é¦¨ä½“éªŒ"),i("ï¼šå¯å®ˆæŠ¤ 3 ä½äº²å‹ï¼Œäº«å—åŸºç¡€é‚®ä»¶æé†’ã€‚")]),r("li",null,[r("strong",null,"VIP å®ˆæŠ¤ç¤¼é‡"),i("ï¼šå¯å®ˆæŠ¤ 20 ä½äº²å‹ï¼Œç”Ÿæ—¥å½“å¤©è‡ªåŠ¨å‘é€çŸ­ä¿¡æš–è¯­ã€‚")]),r("li",null,"å¡«å†™è§’è‰²ç”µè¯åŽï¼ŒVIP ç”¨æˆ·å°†åœ¨ç”Ÿæ—¥å½“å¤©æŠŠå¤‡æ³¨ç¥ç¦é€šè¿‡çŸ­ä¿¡é€ç»™å¯¹æ–¹ã€‚"),r("li",null,[i("å¦‚éœ€å¼€é€š / ç»­è®¢ VIPï¼Œè¯·å‘é€é‚®ä»¶è‡³ "),r("a",{href:"mailto:yinyc0925@outlook.com",target:"_blank"},"yinyc0925@outlook.com"),i(" è”ç³»ç«™ä¸»ã€‚")])],-1))]),_:1})]),l(Q,{data:k.value,style:{width:"100%"},border:""},{default:t(()=>[l(p,{prop:"roleType",label:"è§’è‰²ç±»åž‹",width:"120"}),l(p,{prop:"roleName",label:"è§’è‰²åç§°",width:"120"}),l(p,{prop:"birthDate",label:"å‡ºç”Ÿæ—¥æœŸ",width:"120"}),l(p,{label:"æ—¥åŽ†ç±»åž‹",width:"100"},{default:t(n=>[i(d(n.row.calendarType===1?"é˜³åŽ†":"é˜´åŽ†"),1)]),_:1}),l(p,{prop:"lunarBirthDate",label:"é˜´åŽ†ç”Ÿæ—¥",width:"120"}),l(p,{prop:"remindDays",label:"æå‰æé†’å¤©æ•°",width:"120"}),l(p,{prop:"rolePhone",label:"è§’è‰²ç”µè¯",width:"140"}),l(p,{prop:"remark",label:"å¤‡æ³¨"}),l(p,{label:"æ“ä½œ",width:"150",fixed:"right"},{default:t(n=>[l(f,{size:"small",onClick:ne=>Y(n.row)},{default:t(()=>[...e[15]||(e[15]=[i("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),l(f,{size:"small",type:"danger",onClick:ne=>F(n.row)},{default:t(()=>[...e[16]||(e[16]=[i("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),l(ae,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=n=>b.value=n),title:h.value?"ç¼–è¾‘è§’è‰²":"æ·»åŠ è§’è‰²",width:"500px"},{footer:t(()=>[l(f,{onClick:e[7]||(e[7]=n=>b.value=!1)},{default:t(()=>[...e[19]||(e[19]=[i("å–æ¶ˆ",-1)])]),_:1}),l(f,{type:"primary",onClick:z},{default:t(()=>[...e[20]||(e[20]=[i("ç¡®å®š",-1)])]),_:1})]),default:t(()=>[l(oe,{model:s,rules:U,ref_key:"roleFormRef",ref:V,"label-width":"120px"},{default:t(()=>[l(v,{label:"è§’è‰²ç±»åž‹",prop:"roleType"},{default:t(()=>[l(Z,{modelValue:s.roleType,"onUpdate:modelValue":e[0]||(e[0]=n=>s.roleType=n),placeholder:"è¯·é€‰æ‹©è§’è‰²ç±»åž‹"},{default:t(()=>[l(m,{label:"çˆ¶äº²",value:"çˆ¶äº²"}),l(m,{label:"æ¯äº²",value:"æ¯äº²"}),l(m,{label:"çˆ·çˆ·",value:"çˆ·çˆ·"}),l(m,{label:"å¥¶å¥¶",value:"å¥¶å¥¶"}),l(m,{label:"å¤–å…¬",value:"å¤–å…¬"}),l(m,{label:"å¤–å©†",value:"å¤–å©†"}),l(m,{label:"å…„å¼Ÿ",value:"å…„å¼Ÿ"}),l(m,{label:"å§å¦¹",value:"å§å¦¹"}),l(m,{label:"æœ‹å‹",value:"æœ‹å‹"}),l(m,{label:"å…¶ä»–",value:"å…¶ä»–"})]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"è§’è‰²åç§°",prop:"roleName"},{default:t(()=>[l(I,{modelValue:s.roleName,"onUpdate:modelValue":e[1]||(e[1]=n=>s.roleName=n),placeholder:"è¯·è¾“å…¥è§’è‰²åç§°"},null,8,["modelValue"])]),_:1}),l(v,{label:"æ—¥åŽ†ç±»åž‹",prop:"calendarType"},{default:t(()=>[l(ee,{modelValue:s.calendarType,"onUpdate:modelValue":e[2]||(e[2]=n=>s.calendarType=n)},{default:t(()=>[l(N,{label:1},{default:t(()=>[...e[17]||(e[17]=[i("é˜³åŽ†",-1)])]),_:1}),l(N,{label:2},{default:t(()=>[...e[18]||(e[18]=[i("é˜´åŽ†",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"å‡ºç”Ÿæ—¥æœŸ",prop:"birthDate"},{default:t(()=>[l(le,{modelValue:s.birthDate,"onUpdate:modelValue":e[3]||(e[3]=n=>s.birthDate=n),type:"date",placeholder:"è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ",format:"YYYYå¹´MæœˆDå· dddd","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(v,{label:"æå‰æé†’å¤©æ•°",prop:"remindDays"},{default:t(()=>[l(te,{modelValue:s.remindDays,"onUpdate:modelValue":e[4]||(e[4]=n=>s.remindDays=n),min:1,max:30},null,8,["modelValue"])]),_:1}),l(v,{label:"è§’è‰²ç”µè¯",prop:"rolePhone"},{default:t(()=>[l(I,{modelValue:s.rolePhone,"onUpdate:modelValue":e[5]||(e[5]=n=>s.rolePhone=n),placeholder:"ç”¨äºŽç”Ÿæ—¥å½“å¤©å‘é€çŸ­ä¿¡"},null,8,["modelValue"])]),_:1}),l(v,{label:"å¤‡æ³¨",prop:"remark"},{default:t(()=>[l(I,{modelValue:s.remark,"onUpdate:modelValue":e[6]||(e[6]=n=>s.remark=n),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥å¤‡æ³¨"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ye=re(Ue,[["__scopeId","data-v-2e08ec63"]]);export{Ye as default};
