import{_ as y,r as v,a as x,c as b,o as I,b as t,w as r,d as a,u as L,e as m,f as i,E as l}from"./index-BLLjHX9z.js";import{l as N}from"./auth-BO-9wJ8L.js";import"./request-Eu6Wjmw7.js";const B={class:"login-container"},C={class:"link"},E={__name:"Login",setup(S){const c=L(),u=v(null),s=x({account:"",password:""}),_={account:[{required:!0,message:"请输入用户名或邮箱",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},f=async()=>{try{await u.value.validate(),console.log("发送登录请求:",s);const e=await N(s);console.log("登录响应:",e),e.data&&e.data.token?(localStorage.setItem("token",e.data.token),localStorage.setItem("userInfo",JSON.stringify(e.data)),l.success("登录成功"),e.data.role==="admin"?c.push("/admin"):c.push("/")):l.error("登录失败：未获取到token")}catch(e){if(console.error("登录错误:",e),e.response){console.error("响应数据:",e.response.data);const o=e.response.data.message||"登录失败";l.error(o)}else e.message?l.error(e.message):l.error("网络错误，请检查后端服务")}};return(e,o)=>{const p=a("el-input"),n=a("el-form-item"),g=a("el-button"),w=a("el-form"),k=a("router-link"),V=a("el-card");return I(),b("div",B,[t(V,{class:"login-card"},{default:r(()=>[o[5]||(o[5]=m("h2",{class:"title"},"生日守护者 - 登录",-1)),t(w,{model:s,rules:_,ref_key:"loginForm",ref:u},{default:r(()=>[t(n,{prop:"account"},{default:r(()=>[t(p,{modelValue:s.account,"onUpdate:modelValue":o[0]||(o[0]=d=>s.account=d),placeholder:"用户名或邮箱","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),t(n,{prop:"password"},{default:r(()=>[t(p,{modelValue:s.password,"onUpdate:modelValue":o[1]||(o[1]=d=>s.password=d),type:"password",placeholder:"密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),t(n,null,{default:r(()=>[t(g,{type:"primary",onClick:f,style:{width:"100%"}},{default:r(()=>[...o[2]||(o[2]=[i(" 登录 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),m("div",C,[o[4]||(o[4]=i(" 还没有账号？",-1)),t(k,{to:"/register"},{default:r(()=>[...o[3]||(o[3]=[i("立即注册",-1)])]),_:1})])]),_:1})])}}},M=y(E,[["__scopeId","data-v-9e8e4ac6"]]);export{M as default};
